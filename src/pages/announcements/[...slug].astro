---
import { getCollection } from "astro:content";
import Section from "../../components/ui/Section.astro";
import BaseLayout from "../../layouts/BaseLayout.astro";

// 使用原生 Date API 替代 date-fns 的 format
function formatDate(date: Date, fmt: string): string {
  const y = date.getFullYear();
  const m = String(date.getMonth() + 1).padStart(2, "0");
  const d = String(date.getDate()).padStart(2, "0");
  return fmt.replace("yyyy", String(y)).replace("MM", m).replace("dd", d);
}

export async function getStaticPaths() {
  const announcements = await getCollection("announcements");
  return announcements.map((entry) => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}

const { entry } = Astro.props;
const { Content } = await entry.render();
---

<BaseLayout
  title={`${entry.data.title} | 公司公告`}
  description={entry.data.summary}
>
  <article class="bg-white min-h-screen">
    <!-- Header -->
    <header class="bg-slate-900 py-16 text-center relative overflow-hidden">
      <div
        class="absolute inset-0 bg-linear-to-r from-slate-900 to-blue-900/50"
      >
      </div>
      <div class="container mx-auto px-4 relative z-10 max-w-3xl">
        <div class="flex justify-center gap-2 mb-6">
          {
            entry.data.tags?.map((tag) => (
              <span class="px-3 py-1 text-xs font-semibold text-blue-300 bg-blue-900/50 rounded-full border border-blue-700">
                {tag}
              </span>
            ))
          }
        </div>
        <h1
          class="text-3xl md:text-4xl font-bold text-white mb-6 leading-tight"
        >
          {entry.data.title}
        </h1>
        <div
          class="flex items-center justify-center gap-6 text-slate-400 text-sm"
        >
          <time datetime={entry.data.publishDate.toISOString()}>
            发布时间：{formatDate(entry.data.publishDate, "yyyy-MM-dd")}
          </time>
          <span>
            发布部门：{entry.data.author}
          </span>
        </div>
      </div>
    </header>

    <!-- Content -->
    <Section>
      <div class="max-w-3xl mx-auto prose prose-slate prose-lg">
        <Content />
      </div>

      <div
        class="max-w-3xl mx-auto mt-12 pt-8 border-t border-slate-100 flex justify-between"
      >
        <a
          href="/announcements"
          class="inline-flex items-center text-blue-600 hover:text-blue-800 font-medium group"
        >
          <svg
            class="w-4 h-4 mr-2 group-hover:-translate-x-1 transition-transform"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M15 19l-7-7 7-7"></path>
          </svg>
          返回公告列表
        </a>
      </div>
    </Section>
  </article>
</BaseLayout>
